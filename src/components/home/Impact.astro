---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import LuArrowRight from "~/assets/icons/LuArrowRight.svg";
import dayjs from "~/lib/dayjs";

const pastEvents = await getCollection(
  "events",
  (item) => !!item.data.concluded,
).then((items) =>
  items.sort((a, b) =>
    dayjs(a.data.startDate).isAfter(dayjs(b.data.startDate)) ? -1 : 1,
  ),
);
---

<section>
  <div class="mx-auto max-w-7xl p-8 text-center">
    <h2 class="font-satoshi text-2xl font-bold sm:text-3xl">Our impact</h2>
    <div
      class="mt-6 grid grid-cols-1 grid-rows-9 gap-4 sm:grid-cols-2 sm:grid-rows-5 lg:grid-cols-3 lg:grid-rows-3"
    >
      <div
        class="col-start-1 row-start-1 flex flex-col items-center justify-center rounded-lg bg-red-200 p-4 lg:py-6"
      >
        <p
          class="font-satoshi text-2xl font-bold text-red-800 sm:text-3xl lg:text-4xl"
        >
          {pastEvents.length}
        </p>
        <p class="text-sm sm:text-base lg:mt-0.5 lg:text-lg">
          events ran since 2024
        </p>
      </div>
      <div
        class="col-start-1 row-start-4 flex flex-col items-center justify-center rounded-lg bg-amber-200 p-4 sm:col-start-2 sm:row-start-3 lg:py-6"
      >
        <p
          class="font-satoshi text-2xl font-bold text-amber-800 sm:text-3xl lg:text-4xl"
        >
          100+
        </p>
        <p class="text-sm sm:text-base lg:mt-0.5 lg:text-lg">
          young people attended
        </p>
      </div>
      <div
        class="col-start-1 row-start-7 flex flex-col items-center justify-center rounded-lg bg-cyan-200 p-4 sm:row-start-4 lg:col-start-3 lg:row-start-1 lg:py-6"
      >
        <p
          class="font-satoshi text-2xl font-bold text-cyan-800 sm:text-3xl lg:text-4xl"
        >
          Lots
        </p>
        <p class="text-sm sm:text-base lg:mt-0.5 lg:text-lg">
          freebies given out
        </p>
      </div>
      {
        pastEvents.slice(0, 3).map((event) => (
          <a
            href={`/events/${event.id}`}
            class="group row-span-2 flex flex-col overflow-clip rounded-lg border border-neutral-300 bg-white text-left shadow-sm transition hover:bg-neutral-100"
          >
            <div class="min-w-0 flex-1 contain-size">
              <Image
                src={
                  (
                    event.data as (typeof event)["data"] & {
                      concluded: true;
                    }
                  ).images[0]
                }
                alt=""
                class="size-full object-cover"
              />
            </div>
            <div class="p-4">
              <p class="font-semibold">{event.data.title}</p>
              <p class="mt-0.5 line-clamp-2 text-sm leading-relaxed text-neutral-600">
                {event.data.description}
              </p>
              <div class="mt-0.5 flex items-center gap-1 text-red-800 group-hover:text-red-900">
                <span class="text-sm font-semibold underline-offset-2 group-hover:underline">
                  Read more
                </span>
                <LuArrowRight
                  class="size-3 transition-transform group-hover:translate-x-px"
                  stroke-width={3}
                />
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</section>
